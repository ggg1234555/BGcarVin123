<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è - –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h1>
            <p class="subtitle">–¢—ä—Ä—Å–µ–Ω–µ –ø–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä –∏–ª–∏ VIN</p>
        </header>

        <nav class="nav-menu">
            <a href="index.html" class="active">–¢—ä—Ä—Å–µ–Ω–µ</a>
            <a href="submit.html">–î–æ–±–∞–≤–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª</a>
        </nav>

        <main>
            <div class="search-section">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="–í—ä–≤–µ–¥–µ—Ç–µ —Ä–µ–≥. ‚Ññ –∏–ª–∏ VIN (17 —Å–∏–º–≤–æ–ª–∞)"
                        maxlength="17"
                        autocomplete="off"
                    >
                    <button id="searchBtn" onclick="searchCar()">–¢—ä—Ä—Å–∏</button>
                </div>
                
                <div id="loadingIndicator" class="loading hidden">
                    <div class="spinner"></div>
                    <span>–¢—ä—Ä—Å–µ–Ω–µ...</span>
                </div>

                <div id="errorMessage" class="error-message hidden"></div>
                
                <div id="results" class="results hidden">
                    <h2>–†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ</h2>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="label">–ú–∞—Ä–∫–∞:</span>
                            <span id="resultMake" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ú–æ–¥–µ–ª:</span>
                            <span id="resultModel" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ì–æ–¥–∏–Ω–∞:</span>
                            <span id="resultYear" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ú–æ—â–Ω–æ—Å—Ç (–∫.—Å.):</span>
                            <span id="resultHP" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ì–æ—Ä–∏–≤–æ:</span>
                            <span id="resultFuel" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ö–∞—Ä–æ—Å–µ—Ä–∏—è:</span>
                            <span id="resultBody" class="value">-</span>
                        </div>
                        <div class="result-item">
                            <span class="label">–ü—Ä–æ–±–µ–≥ (–∫–º):</span>
                            <span id="resultMileage" class="value">-</span>
                        </div>
                        <div class="result-item full-width">
                            <span class="label">–ë–µ–ª–µ–∂–∫–∏:</span>
                            <span id="resultNotes" class="value">-</span>
                        </div>
                    </div>
                    
                    <div id="photoGallery" class="photo-gallery hidden">
                        <h3>–°–Ω–∏–º–∫–∏</h3>
                        <div id="photoGrid" class="photo-grid"></div>
                    </div>

                    <div id="dataSource" class="data-source"></div>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2024 –ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ë—ä–ª–≥–∞—Ä–∏—è</p>
        </footer>
    </div>

    <script>
        // Configuration - Update this with your backend URL
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://bgcarvin123.onrender.com';

        async function searchCar() {
            const input = document.getElementById('searchInput');
            const query = input.value.trim().toUpperCase();
            
            if (!query) {
                showError('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä –∏–ª–∏ VIN');
                return;
            }

            // Hide previous results and errors
            hideElement('results');
            hideElement('errorMessage');
            showElement('loadingIndicator');

            try {
                const response = await fetch(`${API_URL}/api/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ');
                }

                displayResults(data);
            } catch (error) {
                showError(error.message || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞');
            } finally {
                hideElement('loadingIndicator');
            }
        }

        function displayResults(response) {
            const data = response.data;
            
            // Update result fields
            updateField('resultMake', data.make);
            updateField('resultModel', data.model);
            updateField('resultYear', data.year);
            updateField('resultHP', data.hp);
            updateField('resultFuel', data.fuelType || data.fuel);
            updateField('resultBody', data.bodyClass || data.body);
            updateField('resultMileage', data.mileage);
            updateField('resultNotes', data.notes);

            // Display photos if available
            if (data.photos && data.photos.length > 0) {
                displayPhotos(data.photos);
            } else {
                hideElement('photoGallery');
            }

            // Show data source
            const sourceText = response.source === 'local' 
                ? 'üìä –î–∞–Ω–Ω–∏ –æ—Ç –ª–æ–∫–∞–ª–Ω–∞ –±–∞–∑–∞' 
                : 'üåê –î–∞–Ω–Ω–∏ –æ—Ç NHTSA (–°–ê–©)';
            document.getElementById('dataSource').textContent = sourceText;

            showElement('results');
        }

        function displayPhotos(photos) {
            const photoGrid = document.getElementById('photoGrid');
            photoGrid.innerHTML = '';
            
            photos.forEach(url => {
                const img = document.createElement('img');
                img.src = url;
                img.alt = '–°–Ω–∏–º–∫–∞ –Ω–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∞';
                img.onclick = () => window.open(url, '_blank');
                photoGrid.appendChild(img);
            });
            
            showElement('photoGallery');
        }

        function updateField(fieldId, value) {
            const element = document.getElementById(fieldId);
            element.textContent = value || '-';
            element.className = value ? 'value has-data' : 'value';
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            showElement('errorMessage');
        }

        function showElement(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideElement(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // Handle Enter key in search input
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchCar();
            }
        });
    </script>
</body>
</html>