<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–±–∞–≤–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª - –ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üöó –ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h1>
            <p class="subtitle">–î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª</p>
        </header>

        <nav class="nav-menu">
            <a href="index.html">–¢—ä—Ä—Å–µ–Ω–µ</a>
            <a href="submit.html" class="active">–î–æ–±–∞–≤–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª</a>
        </nav>

        <main>
            <div class="submit-section">
                <form id="submitForm" class="submit-form">
                    <div class="form-group">
                        <label for="plate">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä:</label>
                        <input 
                            type="text" 
                            id="plate" 
                            name="plate"
                            placeholder="–Ω–∞–ø—Ä. –°–ê1234–ê–í"
                            maxlength="10"
                        >
                    </div>

                    <div class="form-group">
                        <label for="vin">VIN –Ω–æ–º–µ—Ä:</label>
                        <input 
                            type="text" 
                            id="vin" 
                            name="vin"
                            placeholder="17 —Å–∏–º–≤–æ–ª–∞"
                            maxlength="17"
                        >
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="make">–ú–∞—Ä–∫–∞: <span class="required">*</span></label>
                            <input 
                                type="text" 
                                id="make" 
                                name="make"
                                placeholder="–Ω–∞–ø—Ä. Toyota"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="model">–ú–æ–¥–µ–ª: <span class="required">*</span></label>
                            <input 
                                type="text" 
                                id="model" 
                                name="model"
                                placeholder="–Ω–∞–ø—Ä. Corolla"
                                required
                            >
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="year">–ì–æ–¥–∏–Ω–∞:</label>
                            <input 
                                type="number" 
                                id="year" 
                                name="year"
                                placeholder="–Ω–∞–ø—Ä. 2020"
                                min="1900"
                                max="2025"
                            >
                        </div>

                        <div class="form-group">
                            <label for="hp">–ú–æ—â–Ω–æ—Å—Ç (–∫.—Å.):</label>
                            <input 
                                type="number" 
                                id="hp" 
                                name="hp"
                                placeholder="–Ω–∞–ø—Ä. 150"
                                min="1"
                                max="2000"
                            >
                        </div>

                        <div class="form-group">
                            <label for="mileage">–ü—Ä–æ–±–µ–≥ (–∫–º):</label>
                            <input 
                                type="number" 
                                id="mileage" 
                                name="mileage"
                                placeholder="–Ω–∞–ø—Ä. 50000"
                                min="0"
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="notes">–ë–µ–ª–µ–∂–∫–∏:</label>
                        <textarea 
                            id="notes" 
                            name="notes"
                            rows="4"
                            placeholder="–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª–∞..."
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="photos">–°–Ω–∏–º–∫–∏ (–¥–æ 5 –±—Ä–æ—è):</label>
                        <input 
                            type="file" 
                            id="photos" 
                            name="photos"
                            accept="image/*"
                            multiple
                            class="file-input"
                        >
                        <div id="photoPreview" class="photo-preview"></div>
                    </div>

                    <div class="form-group consent-group">
                        <label class="checkbox-label">
                            <input 
                                type="checkbox" 
                                id="consent" 
                                name="consent"
                                required
                            >
                            <span>–°—ä–≥–ª–∞—Å–µ–Ω/–Ω–∞ —Å—ä–º –¥–∞ –ø—É–±–ª–∏–∫—É–≤–∞—Ç–µ —Ç–µ–∑–∏ –¥–∞–Ω–Ω–∏ –±–µ–∑ –ª–∏—á–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. <span class="required">*</span></span>
                        </label>
                    </div>

                    <div id="submitError" class="error-message hidden"></div>
                    <div id="submitSuccess" class="success-message hidden"></div>

                    <div class="form-actions">
                        <button type="submit" id="submitBtn" class="submit-btn">
                            <span id="submitBtnText">–î–æ–±–∞–≤–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª</span>
                            <span id="submitBtnLoading" class="hidden">–ò–∑–ø—Ä–∞—â–∞–Ω–µ...</span>
                        </button>
                        <button type="button" onclick="resetForm()" class="reset-btn">–ò–∑—á–∏—Å—Ç–∏</button>
                    </div>
                </form>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 –ê–≤—Ç–æ–º–æ–±–∏–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ë—ä–ª–≥–∞—Ä–∏—è</p>
        </footer>
    </div>

    <script>
        // Configuration - Update this with your backend URL
        const API_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://your-backend-url.railway.app'; // Update with your Railway URL

        let selectedPhotos = [];

        document.getElementById('submitForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const plate = document.getElementById('plate').value.trim();
            const vin = document.getElementById('vin').value.trim();
            
            // Validate that at least one identifier is provided
            if (!plate && !vin) {
                showError('–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–µ–Ω –Ω–æ–º–µ—Ä –∏–ª–∏ VIN');
                return;
            }

            // Validate VIN length if provided
            if (vin && vin.length !== 17) {
                showError('VIN –Ω–æ–º–µ—Ä—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –±—ä–¥–µ —Ç–æ—á–Ω–æ 17 —Å–∏–º–≤–æ–ª–∞');
                return;
            }

            // Hide previous messages
            hideElement('submitError');
            hideElement('submitSuccess');
            
            // Show loading state
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtnText').classList.add('hidden');
            document.getElementById('submitBtnLoading').classList.remove('hidden');

            try {
                const formData = new FormData();
                formData.append('plate', plate.toUpperCase());
                formData.append('vin', vin.toUpperCase());
                formData.append('make', document.getElementById('make').value);
                formData.append('model', document.getElementById('model').value);
                formData.append('year', document.getElementById('year').value);
                formData.append('hp', document.getElementById('hp').value);
                formData.append('mileage', document.getElementById('mileage').value);
                formData.append('notes', document.getElementById('notes').value);
                formData.append('consent', document.getElementById('consent').checked);

                // Add photos
                if (selectedPhotos.length > 0) {
                    for (let i = 0; i < Math.min(selectedPhotos.length, 5); i++) {
                        formData.append('photos', selectedPhotos[i]);
                    }
                }

                const response = await fetch(`${API_URL}/api/submit`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ—Ç–æ');
                }

                showSuccess('–ê–≤—Ç–æ–º–æ–±–∏–ª—ä—Ç –µ –¥–æ–±–∞–≤–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                document.getElementById('submitForm').reset();
                selectedPhotos = [];
                clearPhotoPreview();
                
            } catch (error) {
                showError(error.message || '–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞ —Å—ä—Å —Å—ä—Ä–≤—ä—Ä–∞');
            } finally {
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtnText').classList.remove('hidden');
                document.getElementById('submitBtnLoading').classList.add('hidden');
            }
        });

        document.getElementById('photos').addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            
            if (files.length > 5) {
                showError('–ú–æ–∂–µ—Ç–µ –¥–∞ –∫–∞—á–∏—Ç–µ –º–∞–∫—Å–∏–º—É–º 5 —Å–Ω–∏–º–∫–∏');
                e.target.value = '';
                return;
            }

            selectedPhotos = files;
            displayPhotoPreview(files);
        });

        function displayPhotoPreview(files) {
            const preview = document.getElementById('photoPreview');
            preview.innerHTML = '';

            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `
                        <img src="${e.target.result}" alt="Preview ${index + 1}">
                        <span class="preview-name">${file.name}</span>
                    `;
                    preview.appendChild(div);
                };
                reader.readAsDataURL(file);
            });
        }

        function clearPhotoPreview() {
            document.getElementById('photoPreview').innerHTML = '';
            document.getElementById('photos').value = '';
        }

        function resetForm() {
            document.getElementById('submitForm').reset();
            selectedPhotos = [];
            clearPhotoPreview();
            hideElement('submitError');
            hideElement('submitSuccess');
        }

        function showError(message) {
            const errorElement = document.getElementById('submitError');
            errorElement.textContent = message;
            showElement('submitError');
            hideElement('submitSuccess');
        }

        function showSuccess(message) {
            const successElement = document.getElementById('submitSuccess');
            successElement.textContent = message;
            showElement('submitSuccess');
            hideElement('submitError');
        }

        function showElement(id) {
            document.getElementById(id).classList.remove('hidden');
        }

        function hideElement(id) {
            document.getElementById(id).classList.add('hidden');
        }
    </script>
</body>
</html>